http://ihjezly.com, http://www.ihjezly.com, http://168.231.124.185 {
    # Handle CORS preflight
    @options {
        method OPTIONS
        path /api/*
    }
    handle @options {
        header Access-Control-Allow-Origin "*"
        header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
        header Access-Control-Allow-Headers "*"
        header Access-Control-Allow-Credentials "true"
        respond 200
    }

    handle /images/* {
        reverse_proxy api:5050 {
            header_down Access-Control-Allow-Origin "*"
            header_down Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
            header_down Access-Control-Allow-Headers "*"
            header_down Access-Control-Allow-Credentials "true"
        }
    }

    # API reverse proxy (keep /api prefix)
    handle /api/* {
        reverse_proxy api:5050 {
            header_down Access-Control-Allow-Origin "*"
            header_down Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
            header_down Access-Control-Allow-Headers "*"
            header_down Access-Control-Allow-Credentials "true"
        }
    }

    # SPA frontend (catch-all fallback)
    handle {
        root * /usr/share/caddy
        file_server
        try_files {path} {path}/ /index.html
    }

    encode gzip
}